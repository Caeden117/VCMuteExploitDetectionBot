using DSharpPlus;
using DSharpPlus.Entities;
using DSharpPlus.EventArgs;
using System.Collections.Concurrent;
using System.Threading.Tasks;

namespace VCMuteExploitDetectionBot.Services
{
    public class MuteDetectionService
    {
        public ConcurrentDictionary<ulong, DiscordVoiceState> CurrentVoiceStates { get; } = new();

        public MuteDetectionService(DiscordClient client)
        {
            client.VoiceStateUpdated += Client_VoiceStateUpdated;
        }

        private Task Client_VoiceStateUpdated(DiscordClient sender, VoiceStateUpdateEventArgs e)
        {
            CurrentVoiceStates.AddOrUpdate(e.User.Id, (_) => e.After, (_, _) => e.After);
            return Task.CompletedTask;
        }
    }
}
