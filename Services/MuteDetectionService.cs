using Discord;
using Discord.WebSocket;
using System.Collections.Concurrent;
using System.Threading.Tasks;

namespace VCMuteExploitDetectionBot.Services
{
    public class MuteDetectionService
    {
        public ConcurrentDictionary<ulong, IVoiceState> CurrentVoiceStates { get; } = new();

        public MuteDetectionService(DiscordSocketClient client)
        {
            client.UserVoiceStateUpdated += Client_UserVoiceStateUpdated;
        }

        private Task Client_UserVoiceStateUpdated(SocketUser user, SocketVoiceState _, SocketVoiceState voiceState)
        {
            CurrentVoiceStates.AddOrUpdate(user.Id, (_) => voiceState, (_, _) => voiceState);
            return Task.CompletedTask;
        }
    }
}
